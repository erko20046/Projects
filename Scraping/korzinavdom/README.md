
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞ korzinavdom.kz

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞ [korzinavdom.kz/catalog](https://korzinavdom.kz/catalog), —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º —á–µ—Ä–µ–∑ Apache Airflow. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –≤–∏–¥–µ DAG, –∑–∞–ø—É—Å–∫–∞–µ–º–æ–≥–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.12**
- **Apache Airflow** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è DAG
- **Selenium + Firefox Remote** ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **ClickHouse** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
- **clickhouse-connect** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **pandas** ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- **Docker (Selenium Grid)** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ headless-–±—Ä–∞—É–∑–µ—Ä–∞

---

## –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞

- DAG –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 (–ø–æ–ª–Ω–æ—á—å)**
- –ù–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ `schedule_interval='@daily'` –≤ Airflow

---

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç DAG

### –®–∞–≥ 1: `fetch_data`

- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç [korzinavdom.kz/catalog](https://korzinavdom.kz/catalog)
- –°–∫—Ä–æ–ª–ª–∏—Ç –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —á—Ç–æ–±—ã –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
- –û–±—Ö–æ–¥–∏—Ç **–≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤**
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
  - `product_name` ‚Äî –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  - `article` ‚Äî –∞—Ä—Ç–∏–∫—É–ª (–≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏)
  - `price` ‚Äî —Ü–µ–Ω–∞ –≤ —Ç–µ–Ω–≥–µ
  - `product_url` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
  - `parsed_at` ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ 21+ (–µ—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π CSV:  
  `/tmp/tmp_parsed_data.csv`

### –®–∞–≥ 2: `transform_data`

- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –û—á–∏—â–∞–µ—Ç —Ü–µ–Ω—É –æ—Ç —Å–∏–º–≤–æ–ª–æ–≤ `‚Ç∏` –∏ –ø—Ä–æ–±–µ–ª–æ–≤
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ü–µ–Ω—É –≤ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ (`int`)
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ClickHouse —á–µ—Ä–µ–∑ `BaseHook`
- –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `products`, –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –í—ã–ø–æ–ª–Ω—è–µ—Ç `INSERT INTO` —Ç–µ–∫—É—â–∏—Ö —Å—Ç—Ä–æ–∫

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –≤ ClickHouse

```sql
CREATE TABLE IF NOT EXISTS products (
    product_name String,
    article      UInt64,
    price        UInt64,
    product_url  String,
    parsed_at    DateTime
)
ENGINE = MergeTree
ORDER BY (article) 
```

--- 





### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–∞–∫ –∫–∞–∫ –º–æ—è –º–∞—à–∏–Ω–∞ (macOS) –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º, —è –∑–∞–ø—É—Å–∫–∞–ª –æ–±–ª–µ–≥—á–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é DAG-–∞:
dag/korzinavdom_selenium_parsing_test.py ‚Äî —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –Ω–∞ ~8 –∫–∞—Ä—Ç–æ—á–µ–∫.

–ï—Å–ª–∏ —É –≤–∞—Å –±–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π DAG:
korzinavdom_selenium_parsing.py, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –≤–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥.

‚∏ª

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–°–∫—Ä–∏–Ω—à–æ—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ DAG –∏ –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ:
üìÅ result/
